<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online LPK12 Course</title>
    <!-- BootStrap 5 CDN Link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
	<script type="text/javascript" src="../static/global.js"></script>
    <!-- Custom CSS link -->
    <<!-- link rel="stylesheet" href="newstyle.css"> -->
</head>
<body>
<section class="vh-100" style="background-color: #eee;">
  <div class="container h-100">
    <div class="row d-flex justify-content-center align-items-center h-100">
      <div class="col-lg-12 col-xl-11">
        <div class="card text-black" style="border-radius: 25px;">
          <div class="card-body p-md-5">
            <div class="row justify-content-center">
              <div class="col-md-10 col-lg-6 col-xl-5 order-2 order-lg-1">

                <p class="text-center h1 fw-bold mb-5 mx-1 mx-md-4 mt-4">Sign up</p>

                <form class="mx-1 mx-md-4" id="form" method="post">
					<div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
						<select class="select" id="role" name="role">
							<option value="Student">Student</option>
							<option value="Teacher">Teacher</option>
						</select>
					 </div>
					</div>
                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="text" id="firstname" class="form-control" />
                      <label class="form-label" for="firstname">First Name</label>
                    </div>
                  </div>
                  
                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="text" id="lastname" class="form-control" />
                      <label class="form-label" for="lastname">Last Name</label>
                    </div>
                  </div>
                  
                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-user fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="text" id="username" class="form-control" />
                      <label class="form-label" for="username">User Name</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-envelope fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="email" id="email" class="form-control" />
                      <label class="form-label" for="email">Email</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-lock fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="password" id="password" class="form-control" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}" title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"/>
                      <label class="form-label" for="password">Password</label>
                    </div>
                  </div>

                  <div class="d-flex flex-row align-items-center mb-4">
                    <i class="fas fa-key fa-lg me-3 fa-fw"></i>
                    <div class="form-outline flex-fill mb-0">
                      <input type="password" id="repeatpassword" class="form-control" />
                      <label class="form-label" for="repeatpassword">Confirm Password</label>
                    </div>
                  </div>

                  <div class="form-check d-flex justify-content-center mb-5">
                    <input class="form-check-input me-2" type="checkbox" value="" id="form2Example3c" />
                    <label class="form-check-label" for="form2Example3">
                      I agree all statements in <a href="#!">Terms of service</a>
                    </label>
                  </div>

                  <div class="d-flex justify-content-center mx-4 mb-3 mb-lg-4">
                    <button type="submit" value="Register" class="btn btn-primary btn-lg">Register</button>
                  </div>

                </form>

              </div>
              <div class="col-md-10 col-lg-6 col-xl-7 d-flex align-items-center order-1 order-lg-2">

                <img src="https://mdbcdn.b-cdn.net/img/Photos/new-templates/bootstrap-registration/draw1.webp"
                  class="img-fluid" alt="Sample image">

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
</body>
<script type="text/javascript">
	    var form=document.getElementById('form');
	    form.addEventListener('submit', function(e){
	    	e.preventDefault()
		 	var firstname=document.getElementById('firstname').value;
	        var lastname=document.getElementById('lastname').value;
	       
			var roles=document.getElementById('role').value;
	        var username=document.getElementById('username').value;
	
	        var email=document.getElementById('email').value;
	        /* var courseId='Online Lpk12'; */
	        
	        
	        var pwdObj = document.getElementById('password').value;
	        var repeat_pwd = document.getElementById('repeatpassword').value;
	        if(pwdObj!= repeat_pwd) {
	        	alert("Password and Confirm Password doesn't match");
	        	location.href="register.html";
	        }
	        console.log("testing");
	        var isactive=false;
	       	if (roles=='Student'){
	    	   isactive=true;
	       	}
	       /* var hashObj = new jsSHA("SHA-512", "TEXT", {numRounds: 1});
	        hashObj.update(pwdObj.value);
	        var hash = hashObj.getHash("HEX");
	        pwdObj.value = hash;
	        console.log(pwdObj)
	
	      var role=[];
	        for(var i=0;i<roles.length;i++){
	        	role.push({roles[i]})
	        }
	        
	
	      var isStudent=false;
	
	        if(role=="Student"){
	
	            isStudent=true;
	
	        }
	
	        console.log(isStudent) */
	
	        console.log([roles])
	        console.log(isactive)
	
	        //fetch post request
	   
			 const corsProxy = "https://onlinelpk12-corsproxy.herokuapp.com/";
             const signUpAPI = dotnet_endpoint+"api/User/Register";
	        fetch(signUpAPI,{
	            method:'POST',
	            body: JSON.stringify({
					"firstname":firstname,
					"lastname":lastname,
	                "username":username,
	                "EmailId":email,
					"isStudent":isactive,
	                "password":pwdObj,
	            }),
		        headers:{
		            "Content-Type":"application/json"
		        }
	        }).then(function(response){
	            var resp=response.json();
	       		if(response.status==200){
	       			//US-13
	       			resp.then((data)=>{       			 
	       			 var userid = parseInt(data.content);
	       			 const createRootFolderAPI = dotnet_endpoint+"api/SparcFileSystem/createrootfolder";
	       			 var createRootFolderApi = new URL(createRootFolderAPI);
	       			 var body = {
	       					 		userId :userid
	       					 	} // or:
	       					 			
	       			 //createRootFolderApi.search = new URLSearchParams(params).toString();
					 console.log(createRootFolderApi);
	       			 fetch(createRootFolderApi,{
	       				 method:'POST',
	       				 body: JSON.stringify(body),
	       				headers: {
	       				    'Content-type': 'application/json; charset=UTF-8',
	       				  }
	       			 }).then(function(response)
	       							{
	       						if(response.status==200){
	       							console.log(data)
	       							location.href="login.html"
	       						}
	       							}
	       							)
							
	       				       			
	       			});
	           	}
	            else{
	                if(response.status==400){
	                	resp.then((data)=>{
	                		alert(data.message)
	                        location.href="register.jsp"
	                    })
	                }
	            }   
	            return response.json();
	        }).then(function(data){
	            console.log(data);
	        })
	    })
	</script>
</html>
